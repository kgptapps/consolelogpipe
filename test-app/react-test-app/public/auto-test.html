<!DOCTYPE html>
<html>
<head>
    <title>Automated Console Log Pipe Test</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🤖 Automated Console Log Pipe Test</h1>
        
        <div id="status" class="status info">
            Status: Starting automated test...
        </div>
        
        <div id="logs" class="log">
Test Log Output:
================
        </div>
    </div>

    <script src="../node_modules/@kansnpms/console-log-pipe-client/dist/console-log-pipe.umd.js"></script>
    
    <script>
        let testStep = 0;
        let logOutput = '';
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = 'status ' + type;
            statusDiv.innerHTML = message;
        }
        
        function addLog(message) {
            logOutput += new Date().toISOString() + ': ' + message + '\n';
            document.getElementById('logs').textContent = 'Test Log Output:\n================\n' + logOutput;
        }
        
        async function runAutomatedTest() {
            try {
                addLog('🚀 Starting automated test sequence...');
                updateStatus('Running automated test...', 'info');
                
                // Step 1: Check if ConsoleLogPipe is available
                testStep = 1;
                addLog('Step 1: Checking Console Log Pipe availability...');
                if (typeof ConsoleLogPipe === 'undefined') {
                    throw new Error('ConsoleLogPipe not found');
                }
                addLog('✅ Console Log Pipe library loaded successfully');
                
                // Step 2: Initialize Console Log Pipe
                testStep = 2;
                addLog('Step 2: Initializing Console Log Pipe...');
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay
                
                ConsoleLogPipe.init({
                    applicationName: 'react-test-app',
                    port: 3008
                });
                
                addLog('✅ Console Log Pipe initialized');
                
                // Step 3: Wait a moment for connection to establish
                testStep = 3;
                addLog('Step 3: Waiting for connection to establish...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Step 4: Send test logs automatically
                testStep = 4;
                addLog('Step 4: Sending test logs...');
                
                // Send different types of logs with delays
                console.log('🧪 AUTO-TEST: Basic log message');
                addLog('Sent: Basic log message');
                
                await new Promise(resolve => setTimeout(resolve, 200));
                console.warn('🧪 AUTO-TEST: Warning message');
                addLog('Sent: Warning message');
                
                await new Promise(resolve => setTimeout(resolve, 200));
                console.error('🧪 AUTO-TEST: Error message');
                addLog('Sent: Error message');
                
                await new Promise(resolve => setTimeout(resolve, 200));
                console.info('🧪 AUTO-TEST: Info message');
                addLog('Sent: Info message');
                
                // Step 5: Send complex object
                testStep = 5;
                addLog('Step 5: Sending complex object...');
                await new Promise(resolve => setTimeout(resolve, 200));
                
                const testObject = {
                    testId: 'auto-test-' + Date.now(),
                    timestamp: new Date().toISOString(),
                    data: {
                        numbers: [1, 2, 3, 4, 5],
                        strings: ['hello', 'world', 'test'],
                        nested: { level1: { level2: 'deep value' } }
                    }
                };
                
                console.log('🧪 AUTO-TEST: Complex object:', testObject);
                addLog('Sent: Complex object');
                
                // Step 6: Test error with stack trace
                testStep = 6;
                addLog('Step 6: Testing error with stack trace...');
                await new Promise(resolve => setTimeout(resolve, 200));
                
                try {
                    throw new Error('🧪 AUTO-TEST: Test error with stack trace');
                } catch (error) {
                    console.error('🧪 AUTO-TEST: Caught error:', error);
                    addLog('Sent: Error with stack trace');
                }
                
                // Step 7: Send rapid-fire logs
                testStep = 7;
                addLog('Step 7: Sending rapid-fire logs...');
                await new Promise(resolve => setTimeout(resolve, 200));
                
                for (let i = 1; i <= 5; i++) {
                    console.log(`🧪 AUTO-TEST: Rapid log #${i}`);
                    await new Promise(resolve => setTimeout(resolve, 50));
                }
                addLog('Sent: 5 rapid-fire logs');
                
                // Final step
                addLog('🎉 Automated test sequence completed!');
                addLog('📊 Total messages sent: ~12 log messages');
                addLog('🔍 Check CLI terminal for received messages');
                
                updateStatus('✅ Automated test completed! Check CLI terminal for messages.', 'success');
                
            } catch (error) {
                addLog(`❌ Test failed at step ${testStep}: ${error.message}`);
                updateStatus(`❌ Test failed at step ${testStep}: ${error.message}`, 'error');
                console.error('🧪 AUTO-TEST: Test failure:', error);
            }
        }
        
        // Start the automated test when page loads
        window.addEventListener('load', function() {
            setTimeout(runAutomatedTest, 1000); // Start after 1 second
        });
    </script>
</body>
</html>
