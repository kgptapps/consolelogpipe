<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Console Log Pipe Test - Port 9229</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .status {
        padding: 15px;
        margin: 15px 0;
        border-radius: 8px;
        border-left: 4px solid;
      }
      .status.info {
        background: #e3f2fd;
        border-color: #2196f3;
        color: #1565c0;
      }
      .status.success {
        background: #e8f5e8;
        border-color: #4caf50;
        color: #2e7d32;
      }
      .status.error {
        background: #ffebee;
        border-color: #f44336;
        color: #c62828;
      }

      button {
        background: #2196f3;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        margin: 10px 10px 10px 0;
        transition: background 0.2s;
      }
      button:hover {
        background: #1976d2;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .logs {
        background: #1e1e1e;
        color: #e0e0e0;
        padding: 20px;
        border-radius: 8px;
        font-family: 'Monaco', 'Menlo', monospace;
        font-size: 14px;
        line-height: 1.5;
        max-height: 400px;
        overflow-y: auto;
        margin: 20px 0;
      }
      .timestamp {
        color: #888;
      }
      .success-text {
        color: #4caf50;
      }
      .error-text {
        color: #f44336;
      }
      .info-text {
        color: #2196f3;
      }

      code {
        background: #f0f0f0;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ Console Log Pipe Test</h1>

      <div class="status info">
        <strong>CLI Server:</strong>
        <code>npx clp start --port 9229 --no-browser</code><br />
        <strong>Test Purpose:</strong> Verify console messages reach CLI
        terminal
      </div>

      <div id="status" class="status info">Ready to test...</div>

      <div>
        <button onclick="runTest()" id="testBtn">üöÄ Run Test</button>
        <button onclick="clearLogs()">üßπ Clear Logs</button>
      </div>

      <div id="logs" class="logs"></div>
    </div>

    <!-- Console Log Pipe Client -->
    <script src="https://unpkg.com/@kansnpms/console-log-pipe-client@2.4.7/dist/console-log-pipe.umd.js"></script>

    <script>
      const statusDiv = document.getElementById('status');
      const logsDiv = document.getElementById('logs');
      const testBtn = document.getElementById('testBtn');

      function updateStatus(message, type = 'info') {
        statusDiv.className = `status ${type}`;
        statusDiv.innerHTML = message;
      }

      function addLog(message, type = '') {
        const timestamp = new Date().toLocaleTimeString();
        const typeClass = type ? ` class="${type}-text"` : '';
        logsDiv.innerHTML += `<div><span class="timestamp">[${timestamp}]</span> <span${typeClass}>${message}</span></div>`;
        logsDiv.scrollTop = logsDiv.scrollHeight;
      }

      function clearLogs() {
        logsDiv.innerHTML = '';
      }

      async function runTest() {
        testBtn.disabled = true;
        clearLogs();
        updateStatus('üß™ Running test...', 'info');

        addLog('=== Console Log Pipe Test Started ===');

        try {
          // Step 1: Check if library loaded
          addLog('1. Checking Console Log Pipe library...', 'info');
          if (typeof ConsoleLogPipe === 'undefined') {
            throw new Error('ConsoleLogPipe not loaded from CDN');
          }
          addLog(
            `‚úÖ Library loaded successfully (v${ConsoleLogPipe.version})`,
            'success'
          );

          // Step 2: Initialize connection
          addLog('2. Connecting to CLI server on port 9229...', 'info');
          await ConsoleLogPipe.init({
            serverPort: 9229,
            serverHost: 'localhost',
          });
          addLog('‚úÖ Connected to CLI server successfully', 'success');

          // Step 3: Send test messages
          addLog('3. Sending console messages...', 'info');

          console.log('üß™ TEST LOG: Hello from browser console!');
          console.error('üß™ TEST ERROR: This is a test error message');
          console.warn('üß™ TEST WARN: This is a test warning');
          console.info('üß™ TEST INFO: This is a test info message');

          // Test with object
          console.log('üß™ TEST OBJECT:', {
            message: 'Test object logging',
            timestamp: new Date().toISOString(),
            data: [1, 2, 3, 4, 5],
          });

          addLog('‚úÖ Console messages sent successfully', 'success');
          addLog(
            'üìã Check your CLI terminal - you should see the test messages above',
            'info'
          );

          updateStatus(
            '‚úÖ Test completed successfully! Check CLI terminal for messages.',
            'success'
          );
        } catch (error) {
          addLog(`‚ùå Test failed: ${error.message}`, 'error');
          updateStatus(`‚ùå Test failed: ${error.message}`, 'error');

          // Troubleshooting info
          addLog('', '');
          addLog('üîß Troubleshooting:', 'info');
          addLog(
            '‚Ä¢ Make sure CLI server is running: npx clp start --port 9229 --no-browser'
          );
          addLog('‚Ä¢ Check if port 9229 is accessible');
          addLog('‚Ä¢ Verify no firewall is blocking the connection');
        }

        testBtn.disabled = false;
      }

      // Initialize when page loads
      window.addEventListener('load', function () {
        addLog('üîç Test page loaded successfully');

        if (typeof ConsoleLogPipe !== 'undefined') {
          addLog(
            `‚úÖ Console Log Pipe library loaded (v${ConsoleLogPipe.version})`,
            'success'
          );
          updateStatus('‚úÖ Ready to test - Click "Run Test" button', 'success');
        } else {
          addLog('‚ùå Console Log Pipe library failed to load', 'error');
          updateStatus(
            '‚ùå Library loading failed - Check internet connection',
            'error'
          );
        }
      });
    </script>
  </body>
</html>
